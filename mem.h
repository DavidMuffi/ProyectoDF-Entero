#ifndef MEM_H
#define MEM _H

#include"comun.h"

#include "systemc.h"
#include "fifo.h"

SC_MODULE (mem) {
public:
sc_port<read_if_T<sc_uint<19>>>  readAddr, writeAddr;
sc_port<read_if_T<sc_uint<8>>>  dataIn;
sc_port<write_if_T<sc_uint<8>>>  dataOut;

void lectura();
void escritura();

  SC_CTOR(mem) {
    cout<<"mem: "<<name()<<endl;
	
	memData = new unsigned char[320 * 1024];
	for (int i = 0; i < (320 * 1024); ++i) 
		memData[i] = 0;

	int n = 0; 
	for (int i = 0; i < HEIGHT; ++i) {
		for (int j = 0; j < WIDTH; ++j) {
			memData[n] = i + j;
			++n;
		}
	}


	/*
	for (int i = 0; i < HEIGHT; ++i)
		for (int j = 0; j < WIDTH; ++j) {
			//memData[i * 640 + j] = ((i & 0xf) << 4) | (j & 0xf);
			memData[n] = INIT[n]; // ((n / WIDTH) << 4) | (n % WIDTH);
			++n;
		}
		*/


    SC_THREAD(lectura);
	SC_THREAD(escritura);
  } 
 
  ~mem() {
	  delete memData;     // comprobar que entra aquí y funciona
  }


private:
	unsigned char* memData;
/*
	const unsigned char INIT[HEIGHT * WIDTH] = {	// posible problema con el compilador al inicializar un miembro???
255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,
255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255,
255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255,
255, 255, 255, 0, 0, 255, 255, 255, 255, 255, 255, 0, 0, 255, 255, 255,
255, 255, 255, 0, 0, 255, 255, 255, 255, 255, 255, 0, 0, 255, 255, 255,
255, 255, 255, 0, 0, 255, 255, 255, 255, 255, 255, 0, 0, 255, 255, 255,
255, 255, 255, 0, 0, 255, 255, 255, 255, 255, 255, 0, 0, 255, 255, 255,
255, 255, 255, 0, 0, 255, 255, 255, 255, 255, 255, 0, 0, 255, 255, 255,
255, 255, 255, 0, 0, 255, 255, 255, 255, 255, 255, 0, 0, 255, 255, 255,
255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255,
255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255,
255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 };
*/


/*
		182, 182, 182, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
		182, 183, 184, 12, 13, 14, 16, 17, 18, 19, 21, 22, 23, 24, 25, 26,
		182, 184, 185, 16, 18, 21, 24, 26, 29, 31, 0, 0, 38, 41, 106, 106,
		8, 12, 16, 20, 24, 28, 32, 36, 40, 43, 6, 7, 54, 57, 114, 115,
		8, 13, 18, 190, 193, 196, 40, 45, 50, 55, 60, 65, 69, 74, 122, 123,
		8, 14, 21, 193, 196, 199, 48, 54, 61, 67, 73, 79, 85, 90, 96, 101,
		8, 16, 24, 195, 199, 202, 56, 64, 72, 79, 86, 93, 100, 107, 113, 119,
		8, 17, 27, 36, 46, 55, 64, 73, 82, 91, 99, 108, 116, 123, 131, 138,
		8, 18, 29, 40, 51, 62, 72, 83, 93, 103, 232, 236, 240, 140, 148, 156,
		8, 20, 29, 36, 43, 69, 80, 92, 104, 115, 239, 243, 247, 156, 166, 175,
		8, 21, 33, 40, 48, 75, 89, 101, 114, 127, 245, 250, 255, 173, 184, 194,
		8, 23, 36, 44, 52, 82, 97, 111, 125, 139, 152, 165, 177, 190, 201, 212
	};*/

}; 

#endif